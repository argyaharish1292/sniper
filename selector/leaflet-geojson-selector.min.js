/* 
 * Leaflet GeoJSON Selector v0.4.5 - 2018-05-30 
 * 
 * Copyright 2018 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demo: 
 * http://labs.easyblog.it/maps/leaflet-geojson-selector/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-geojson-selector.git 
 * 
 */
!function(a){if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)module.exports=a(require("leaflet"));else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){return a.Control.GeoJSONSelector=a.Control.extend({includes:"1"===a.version[0]?a.Evented.prototype:a.Mixin.Events,options:{collapsed:!1,position:"bottomleft",listLabel:"properties.name",listSortBy:null,listItemBuild:null,activeListFromLayer:!0,activeLayerFromList:!0,zoomToLayer:!1,listOnlyVisibleLayers:!1,multiple:!1,style:{color:"#00f",fillColor:"#08f",fillOpacity:.4,opacity:1,weight:1},activeClass:"active",activeStyle:{color:"#00f",fillColor:"#fc0",fillOpacity:.6,opacity:1,weight:1},selectClass:"selected",selectStyle:{color:"#00f",fillColor:"#f80",fillOpacity:.8,opacity:1,weight:1}},initialize:function(b,c){a.Util.setOptions(this,c||{});this.options.listSortBy=this.options.listSortBy||this.options.listLabel,this.options.listItemBuild&&(this._itemBuild=this.options.listItemBuild),this._layer=b},onAdd:function(b){var c=a.DomUtil.create("div","geojson-list");return this._baseName="geojson-list",this._map=b,this._container=c,this._id=this._baseName+a.stamp(this._container),this._list=a.DomUtil.create("ul","geojson-list-group",c),this._items=[],a.DomEvent.on(c,"mouseover",function(a){b.scrollWheelZoom.disable()}).on(c,"mouseout",function(a){b.scrollWheelZoom.enable()}),this.options.listOnlyVisibleLayers&&b.on("moveend",this._updateListVisible,this),b.whenReady(function(a){c.style.height=b.getSize().y+"px"}),this._initToggle(),this._updateList(),c},onRemove:function(a){a.off("moveend",this._updateList,this)},reload:function(a){return this._layer=a,this._updateList(),this},_getPath:function(a,b){var c=b.split("."),d=c.pop(),e=c.length,f=c[0],g=1;if(e>0)for(;(a=a[f])&&e>g;)f=c[g++];return a?a[d]:void 0},_itemBuild:function(a){return this._getPath(a.feature,this.options.listLabel)||"&nbsp;"},_selectItem:function(b,c){for(var d=0;d<this._items.length;d++)delete this._items[d].selected,a.DomUtil.removeClass(this._items[d],this.options.selectClass);c&&(b.selected=c,a.DomUtil.addClass(b,this.options.selectClass))},_selectLayer:function(a,b){for(var c=0;c<this._items.length;c++)this._items[c].layer.setStyle&&this._items[c].layer.setStyle(this.options.style);b&&a.setStyle&&a.setStyle(this.options.selectStyle)},_createItem:function(b){var c=this,d=a.DomUtil.create("li","geojson-list-item"),e=document.createElement("label"),f=this.options.multiple?"checkbox":"radio",g=this._createInputElement(f,this._id,!1),h=this._itemBuild.call(this,b);return e.innerHTML=h,e.insertBefore(g,e.firstChild),d.appendChild(e),d.layer=b,b.itemList=d,b.itemLabel=e,a.DomEvent.on(e,"click",a.DomEvent.stop,this).on(e,"click",function(a){c.options.zoomToLayer&&c._moveTo(b),g.checked=!g.checked,c._selectItem(d,g.checked),c._selectLayer(b,g.checked),c.fire("selector:change",{selected:g.checked,layers:[b]})},this),a.DomEvent.on(d,"mouseover",function(b){a.DomUtil.addClass(b.target,this.options.activeClass);for(var e=0;e<c._items.length;e++)c._items[e]||c._items[e].layer.setStyle(c.options.activeStyle);c.options.activeLayerFromList&&d.layer.fire("mouseover")},this).on(d,"mouseout",function(b){a.DomUtil.removeClass(b.target,c.options.activeClass);for(var e=0;e<c._items.length;e++)c._items[e]||c._items[e].layer.setStyle(c.options.style);c.options.activeLayerFromList&&d.layer.fire("mouseout")},this),this._items.push(d),d},_createInputElement:function(a,b,c){var d='<input type="'+a+'" name="'+b+'"';c&&(d+=' checked="checked"'),d+="/>";var e=document.createElement("div");return e.innerHTML=d,e.firstChild},_updateList:function(){var b=this,c=[],d=this.options.listSortBy;this._list.innerHTML="",this._layer.eachLayer(function(d){c.push(d),d.setStyle&&d.setStyle(b.options.style),d.on("click",a.DomEvent.stop).on("click",function(a){a.target.itemLabel.click()}).on("mouseover",function(c){c.target.setStyle(b.options.activeStyle),b.options.activeListFromLayer&&a.DomUtil.addClass(c.target.itemList,b.options.activeClass)}).on("mouseout",function(c){c.target.setStyle(c.target.itemList.selected?b.options.selectStyle:b.options.style),b.options.activeListFromLayer&&a.DomUtil.removeClass(c.target.itemList,b.options.activeClass)})}),c.sort(function(a,c){var e=b._getPath(a.feature,d),f=b._getPath(c.feature,d);return f>e?-1:e>f?1:0});for(var e=0;e<c.length;e++)this._list.appendChild(this._createItem(c[e]))},_updateListVisible:function(){var a,b=this;this._layer.eachLayer(function(c){c.getBounds?a=b._map.getBounds().intersects(c.getBounds()):c.getLatLng&&(a=b._map.getBounds().contains(c.getLatLng())),c.itemList.style.display=a?"block":"none"})},_initToggle:function(){var b=this._container;if(b.setAttribute("aria-haspopup",!0),a.Browser.touch?a.DomEvent.on(b,"click",a.DomEvent.stopPropagation):a.DomEvent.disableClickPropagation(b),this.options.collapsed){this._collapse(),a.Browser.android||a.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var c=this._button=a.DomUtil.create("a","geojson-list-toggle",b);c.href="#",c.title="List GeoJSON",a.Browser.touch?a.DomEvent.on(c,"click",a.DomEvent.stop).on(c,"click",this._expand,this):a.DomEvent.on(c,"focus",this._expand,this),this._map.on("click",this._collapse,this)}},_expand:function(){this._container.className=this._container.className.replace(" geojson-list-collapsed","")},_collapse:function(){a.DomUtil.addClass(this._container,"geojson-list-collapsed")},_moveTo:function(b){var c=this.options.position,d=(this._map._controlCorners[c].clientWidth,new a.Point(this._container.clientWidth,this._container.clientHeight)),e={paddingTopLeft:null,paddingBottomRight:null};-1!==c.indexOf("right")?e.paddingBottomRight=a.point(d.x,0):-1!==c.indexOf("left")&&(e.paddingTopLeft=a.point(d.x,0)),b.getBounds?this._map.fitBounds(b.getBounds(),e):b.getLatLng&&this._map.setView(b.getLatLng())}}),a.control.geoJsonSelector=function(b,c){return new a.Control.GeoJSONSelector(b,c)},a.Control.GeoJSONSelector});